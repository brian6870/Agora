<!-- templates/admin_panel/device_resets/list.html -->
{% extends 'admin_panel/base_admin.html' %}

{% block admin_title %}Device Reset Requests{% endblock %}

{% block admin_content %}
<!-- Filter -->
<div class="filter-bar">
    <form method="get" style="display: flex; gap: 12px; align-items: flex-end;">
        <div style="width: 200px;">
            <label style="display: block; margin-bottom: 4px; color: var(--text-secondary); font-size: 0.9rem;">Status</label>
            <select name="status">
                <option value="">All</option>
                {% for code, label in status_choices %}
                <option value="{{ code }}" {% if selected_status == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <button type="submit" class="btn btn-primary">Apply Filter</button>
        </div>
    </form>
</div>

<!-- Requests Table -->
<div class="card">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>ID Number</th>
                <th>Phone</th>
                <th>Reason</th>
                <th>Requested</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for request in requests %}
            <tr>
                <td>{{ request.full_name }}</td>
                <td>{{ request.id_number }}</td>
                <td>{{ request.phone }}</td>
                <td>{{ request.reason|truncatechars:50 }}</td>
                <td>{{ request.created_at|date:"Y-m-d H:i" }}</td>
                <td>
                    <span class="status-badge {% if request.status == 'APPROVED' %}success{% elif request.status == 'PENDING' %}warning{% elif request.status == 'REJECTED' %}error{% endif %}">
                        {{ request.get_status_display }}
                    </span>
                </td>
                <td>
                    {% if request.status == 'PENDING' %}
                    <form method="post" action="{% url 'admin_panel:process_device_reset' request.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" name="action" value="approve" class="btn btn-success" style="padding: 4px 12px;">Approve</button>
                        <button type="submit" name="action" value="reject" class="btn btn-error" style="padding: 4px 12px; background: var(--error); color: white;">Reject</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 48px;">
                    <p style="color: var(--text-secondary);">No device reset requests found.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}