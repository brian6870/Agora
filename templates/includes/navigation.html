{% load static %}
<!-- Public & Voter Navigation Bar - Hidden from admins -->
<nav class="fixed top-6 left-6 right-6 z-50 backdrop-blur-xl bg-transparent border border-white/30 dark:border-white/20 shadow-2xl rounded-3xl transition-all duration-300 mx-auto max-w-7xl" style="left: 1.5rem; right: 1.5rem; width: auto; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); background: transparent !important;">
    <div class="px-6 sm:px-8 lg:px-10">
        <div class="flex items-center justify-between h-16">
            <!-- Logo -->
            <div class="flex-shrink-0">
                <a href="{% url 'landing' %}" class="text-2xl font-bold text-gray-900 dark:text-white transition-colors duration-200">
                    KUPPET
                </a>
            </div>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex md:items-center md:space-x-4">
                {% if user.is_authenticated %}
                    {% if user.user_type == 'VOTER' %}
                        <!-- VOTER PORTAL NAVIGATION - Essential buttons only -->
                        <a href="{% url 'core:dashboard' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 {% if request.resolver_match.url_name == 'dashboard' %}bg-white/20 dark:bg-white/10 text-gray-900 dark:text-white{% endif %}">
                            Dashboard
                        </a>
                        <a href="{% url 'core:voting_area' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 {% if request.resolver_match.url_name == 'voting_area' %}bg-white/20 dark:bg-white/10 text-gray-900 dark:text-white{% endif %}">
                            Vote
                        </a>
                        <a href="{% url 'core:results' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 {% if request.resolver_match.url_name == 'results' %}bg-white/20 dark:bg-white/10 text-gray-900 dark:text-white{% endif %}">
                            Results
                        </a>
                        <a href="{% url 'core:application_status' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 {% if request.resolver_match.url_name == 'application_status' %}bg-white/20 dark:bg-white/10 text-gray-900 dark:text-white{% endif %}">
                            Applications
                        </a>
                    {% endif %}
                    
                    <!-- User Menu (only for voters) -->
                    {% if user.user_type == 'VOTER' %}
                    <div class="relative ml-2">
                        <button type="button" class="flex items-center space-x-2 text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white transition-colors duration-200" id="user-menu-button">
                            <span class="text-sm font-medium">{{ user.full_name|truncatechars:12 }}</span>
                            <div class="w-8 h-8 rounded-full bg-white/30 dark:bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                <i class="fas fa-user text-sm text-gray-700 dark:text-gray-300"></i>
                            </div>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-40 bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50">
                            <form method="post" action="{% url 'accounts:logout' %}">
                                {% csrf_token %}
                                <button type="submit" class="block w-full text-left px-3 py-1.5 text-xs text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200">
                                    <i class="fas fa-sign-out-alt mr-1"></i>
                                    Logout
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endif %}
                    
                {% else %}
                    <!-- PUBLIC NAVIGATION - Not logged in -->
                    <a href="{% url 'landing' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 {% if request.resolver_match.url_name == 'landing' %}bg-white/20 dark:bg-white/10 text-gray-900 dark:text-white{% endif %}">
                        Home
                    </a>
                    <a href="{% url 'accounts:login' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10">
                        Login
                    </a>
                    <a href="{% url 'accounts:register' %}" class="text-gray-800 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 hover:bg-white/20 dark:hover:bg-white/10 border border-white/30 dark:border-white/20">
                        Register
                    </a>
                    
                    <!-- Admin Portal Button -->
                    <a href="{% url 'accounts:admin_login' %}" class="bg-gray-900 text-white dark:bg-white dark:text-gray-900 px-4 py-2 rounded-full text-sm font-medium shadow-md hover:shadow-lg transition-all duration-200 ml-2">
                        Admin
                    </a>
                {% endif %}
                
                <!-- Theme Toggle (always visible) -->
                <button id="theme-toggle" class="p-2 rounded-full bg-transparent backdrop-blur-sm text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-white/20 dark:hover:bg-white/10 transition-all duration-200" aria-label="Toggle theme">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
            </div>
            
            <!-- Mobile section -->
            <div class="flex md:hidden items-center space-x-2">
                <button id="mobile-theme-toggle" class="p-2 rounded-full bg-transparent backdrop-blur-sm text-gray-700 dark:text-gray-300 hover:bg-white/20 dark:hover:bg-white/10" aria-label="Toggle theme">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
                
                <button type="button" class="mobile-menu-btn p-2 rounded-full bg-transparent backdrop-blur-sm text-gray-700 dark:text-gray-300 hover:bg-white/20 dark:hover:bg-white/10" onclick="toggleMobileMenu()" aria-label="Menu">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 rounded-b-3xl">
        <div class="px-6 pt-2 pb-3 space-y-1">
            {% if user.is_authenticated and user.user_type == 'VOTER' %}
                <!-- Voter Mobile Menu - Essential only -->
                <a href="{% url 'core:dashboard' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Dashboard
                </a>
                <a href="{% url 'core:voting_area' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Vote
                </a>
                <a href="{% url 'core:results' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Results
                </a>
                <a href="{% url 'core:application_status' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Applications
                </a>
                
                <form method="post" action="{% url 'accounts:logout' %}" class="pt-2 mt-2 border-t border-gray-200 dark:border-gray-700">
                    {% csrf_token %}
                    <button type="submit" class="block w-full text-left px-3 py-2 rounded-xl text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Logout
                    </button>
                </form>
                
            {% else %}
                <!-- Public Mobile Menu -->
                <a href="{% url 'landing' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Home
                </a>
                <a href="{% url 'accounts:login' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Login
                </a>
                <a href="{% url 'accounts:register' %}" class="block px-3 py-2 rounded-xl text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                    Register
                </a>
                
                <!-- Admin Portal Button in Mobile Menu -->
                <div class="pt-2 mt-2 border-t border-gray-200 dark:border-gray-700">
                    <a href="{% url 'accounts:admin_login' %}" class="block px-3 py-2 rounded-xl bg-gray-900 text-white dark:bg-white dark:text-gray-900 hover:bg-gray-800 dark:hover:bg-gray-100 transition-all duration-200">
                        Admin Portal
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</nav>

<!-- Spacer for fixed navbar -->
<div class="h-20"></div>

<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const button = document.querySelector('.mobile-menu-btn i');
    if (!menu || !button) return;
    
    menu.classList.toggle('hidden');
    button.className = menu.classList.contains('hidden') ? 'fas fa-bars text-xl' : 'fas fa-times text-xl';
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const menu = document.getElementById('mobile-menu');
    const button = document.querySelector('.mobile-menu-btn');
    const nav = document.querySelector('nav');
    
    if (menu && !menu.classList.contains('hidden') && 
        button && !button.contains(event.target) && 
        !menu.contains(event.target) &&
        nav && !nav.contains(event.target)) {
        menu.classList.add('hidden');
        const icon = document.querySelector('.mobile-menu-btn i');
        if (icon) icon.className = 'fas fa-bars text-xl';
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    if (window.innerWidth >= 768) {
        const menu = document.getElementById('mobile-menu');
        if (menu && !menu.classList.contains('hidden')) {
            menu.classList.add('hidden');
            const icon = document.querySelector('.mobile-menu-btn i');
            if (icon) icon.className = 'fas fa-bars text-xl';
        }
    }
});

// Toggle user dropdown
document.addEventListener('DOMContentLoaded', function() {
    const userMenuButton = document.getElementById('user-menu-button');
    const userDropdown = document.getElementById('user-dropdown');
    
    if (userMenuButton && userDropdown) {
        userMenuButton.addEventListener('click', function(e) {
            e.stopPropagation();
            userDropdown.classList.toggle('hidden');
        });
        
        document.addEventListener('click', function(e) {
            if (userDropdown && !userDropdown.classList.contains('hidden') && 
                !userMenuButton.contains(e.target) && 
                !userDropdown.contains(e.target)) {
                userDropdown.classList.add('hidden');
            }
        });
    }
});
</script>