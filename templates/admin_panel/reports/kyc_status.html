{% extends 'admin_panel/base_admin.html' %}
{% load static %}

{% block title %}KYC Status Report - Agora{% endblock %}

{% block admin_content %}
<div class="max-w-7xl mx-auto space-y-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4 hero-text">
            KYC Status Report
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400">
            Overview of KYC verification status across all voters
        </p>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Total Submissions</p>
            <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_submissions }}</p>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Pending</p>
            <p class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">{{ pending_count }}</p>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Verified</p>
            <p class="text-3xl font-bold text-green-600 dark:text-green-400">{{ verified_count }}</p>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Rejected</p>
            <p class="text-3xl font-bold text-red-600 dark:text-red-400">{{ rejected_count }}</p>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Flagged</p>
            <p class="text-3xl font-bold text-orange-600 dark:text-orange-400">{{ flagged_count }}</p>
        </div>
    </div>

    <!-- Statistics Cards - Simplified -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Verification Rate</p>
            <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ verification_rate }}%</p>
            <div class="mt-2 w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div class="h-full bg-green-500 rounded-full" style="width: {{ verification_rate }}%"></div>
            </div>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Avg. Processing Time</p>
            <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ avg_processing_time }} min</p>
        </div>
        <div class="glass-card p-6">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Verified Today</p>
            <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ verified_today }}</p>
        </div>
    </div>

    <!-- Status Distribution (Simplified - Removed chart) -->
    <div class="glass-card p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Status Distribution</h3>
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-400">Verified</span>
                    <span class="text-gray-900 dark:text-white">{{ verified_count }} ({% widthratio verified_count total_submissions 100 %}%)</span>
                </div>
                <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-green-500 rounded-full" style="width: {% widthratio verified_count total_submissions 100 %}%"></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-400">Pending</span>
                    <span class="text-gray-900 dark:text-white">{{ pending_count }} ({% widthratio pending_count total_submissions 100 %}%)</span>
                </div>
                <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-yellow-500 rounded-full" style="width: {% widthratio pending_count total_submissions 100 %}%"></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-400">Rejected</span>
                    <span class="text-gray-900 dark:text-white">{{ rejected_count }} ({% widthratio rejected_count total_submissions 100 %}%)</span>
                </div>
                <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-red-500 rounded-full" style="width: {% widthratio rejected_count total_submissions 100 %}%"></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-400">Flagged</span>
                    <span class="text-gray-900 dark:text-white">{{ flagged_count }} ({% widthratio flagged_count total_submissions 100 %}%)</span>
                </div>
                <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-orange-500 rounded-full" style="width: {% widthratio flagged_count total_submissions 100 %}%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="glass-card p-6 mb-8">
        <form method="get" class="flex flex-wrap gap-4 items-center">
            <div class="flex-1 min-w-[200px]">
                <input type="text" 
                       name="search" 
                       value="{{ search }}" 
                       class="form-input" 
                       placeholder="Search by name, TSC, or ID...">
            </div>
            <div class="w-48">
                <select name="status" class="form-select">
                    <option value="">All Status</option>
                    <option value="PENDING" {% if status == 'PENDING' %}selected{% endif %}>Pending</option>
                    <option value="VERIFIED" {% if status == 'VERIFIED' %}selected{% endif %}>Verified</option>
                    <option value="REJECTED" {% if status == 'REJECTED' %}selected{% endif %}>Rejected</option>
                    <option value="FLAGGED" {% if status == 'FLAGGED' %}selected{% endif %}>Flagged</option>
                </select>
            </div>
            <div class="w-48">
                <select name="county" class="form-select">
                    <option value="">All Counties</option>
                    {% for county in counties %}
                    <option value="{{ county }}" {% if county == selected_county %}selected{% endif %}>{{ county }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="px-6 py-2 bg-gray-900 text-white dark:bg-white dark:text-gray-900 rounded-full text-sm font-medium hover:bg-gray-800 dark:hover:bg-gray-100 transition">
                Apply Filters
            </button>
            <a href="{% url 'admin_panel:kyc_status_report' %}" class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                Clear
            </a>
        </form>
    </div>

    <!-- KYC List Table -->
    <div class="glass-card overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-white/30 dark:border-white/10 bg-gray-50/50 dark:bg-gray-800/50">
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Voter</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">TSC Number</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">ID Number</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">County</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Submitted</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Status</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Verified By</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Verified At</th>
                        <th class="text-left py-4 px-6 text-sm font-medium text-gray-500 dark:text-gray-400">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for voter in kyc_list %}
                    <tr class="border-b border-white/10 dark:border-white/5 hover:bg-white/5 transition-colors">
                        <td class="py-4 px-6">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-xs text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ voter.full_name }}</span>
                            </div>
                        </td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.tsc_number }}</td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.id_number }}</td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.county }}</td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.kyc_submitted_at|date:"M j, Y"|default:'-' }}</td>
                        <td class="py-4 px-6">
                            <span class="px-3 py-1 rounded-full text-xs font-medium
                                {% if voter.kyc_status == 'VERIFIED' %}bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400
                                {% elif voter.kyc_status == 'PENDING' %}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400
                                {% elif voter.kyc_status == 'REJECTED' %}bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400
                                {% elif voter.kyc_status == 'FLAGGED' %}bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400
                                {% else %}bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400{% endif %}">
                                {{ voter.get_kyc_status_display }}
                            </span>
                        </td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.verified_by.full_name|default:'-' }}</td>
                        <td class="py-4 px-6 text-sm text-gray-600 dark:text-gray-400">{{ voter.verified_at|date:"M j, Y H:i"|default:'-' }}</td>
                        <td class="py-4 px-6">
                            <a href="{% url 'admin_panel:kyc_detail' voter.id %}" 
                               class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                               title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" class="py-12 text-center text-gray-500 dark:text-gray-400">
                            <i class="fas fa-id-card fa-4x mb-4 opacity-50"></i>
                            <p class="text-lg">No KYC data found</p>
                            <p class="text-sm mt-2">Try adjusting your filters</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.hero-text {
    text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transform: perspective(1000px) rotateX(0deg);
    transition: transform 0.3s ease;
}
.hero-text:hover {
    transform: perspective(1000px) rotateX(2deg) translateZ(20px) scale(1.05);
}

/* Table hover effects */
tbody tr:hover td {
    background-color: rgba(0,0,0,0.02);
}

.dark tbody tr:hover td {
    background-color: rgba(255,255,255,0.02);
}
</style>
{% endblock %}