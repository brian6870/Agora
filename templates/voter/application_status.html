{% extends 'base.html' %}
{% load static %}

{% block title %}Application Status - Agora{% endblock %}

{% block content %}
<!-- Fixed navbar spacer - this pushes content below the fixed navbar -->
<div class="h-24 md:h-28 lg:h-32"></div>

<!-- Main scrollable content container -->
<div class="fixed inset-0 top-24 md:top-28 lg:top-32 overflow-y-auto" style="z-index: 1;">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        
        <!-- Header with flex-wrap for better mobile responsiveness -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-semibold text-gray-900 dark:text-white mb-2 hero-text">
                        Application Status
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400">
                        Track your candidate and team applications
                    </p>
                </div>
                
                <!-- Quick Stats -->
                <div class="flex gap-2">
                    <span class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">
                        <i class="fas fa-file-alt mr-2"></i>
                        {{ candidate_applications|length }} Candidate
                    </span>
                    <span class="px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">
                        <i class="fas fa-users mr-2"></i>
                        {{ team_applications|length }} Team
                    </span>
                </div>
            </div>
        </div>

        <!-- Candidate Applications Section -->
        <div class="mb-12">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <div class="w-10 h-10 rounded-full bg-gray-200/50 dark:bg-gray-800/50 flex items-center justify-center mr-3">
                    <i class="fas fa-user-tie text-gray-600 dark:text-gray-400"></i>
                </div>
                Candidate Applications
                <span class="ml-3 px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-xs">
                    {{ candidate_applications|length }} total
                </span>
            </h2>
            
            <!-- Applications Table with overflow-x-auto for responsive scrolling -->
            <div class="bg-transparent backdrop-blur-xl border border-white/30 dark:border-white/20 rounded-2xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">#</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Position</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Election</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Team</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Applied</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Reviewed</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            {% for application in candidate_applications %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
                                <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">{{ forloop.counter }}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        {% if application.photo %}
                                        <img src="{{ application.photo.url }}" alt="{{ application.voter.full_name }}" class="w-8 h-8 rounded-full mr-3 object-cover">
                                        {% else %}
                                        <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                            <i class="fas fa-user text-xs text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        {% endif %}
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">{{ application.position.name }}</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">{{ application.election.name }}</td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                    {% if application.team %}
                                    <span class="inline-flex items-center">
                                        <span class="w-2 h-2 rounded-full mr-2" style="background-color: {{ application.team.color_code }}"></span>
                                        {{ application.team.name }}
                                    </span>
                                    {% else %}
                                    —
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">{{ application.applied_at|date:"M j, Y" }}</td>
                                <td class="px-6 py-4">
                                    <span class="px-3 py-1 rounded-full text-xs font-medium
                                        {% if application.status == 'APPROVED' %}bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400
                                        {% elif application.status == 'PENDING' %}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400
                                        {% elif application.status == 'REJECTED' %}bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400
                                        {% else %}bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400{% endif %}">
                                        {{ application.get_status_display }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                    {% if application.reviewed_at %}
                                        {{ application.reviewed_at|date:"M j, Y" }}
                                        {% if application.reviewed_by %}
                                        <span class="text-xs text-gray-500 block">by {{ application.reviewed_by.full_name }}</span>
                                        {% endif %}
                                    {% else %}
                                        —
                                    {% endif %}
                                </td>
                            </tr>
                            {% if application.rejection_reason %}
                            <tr class="bg-red-50/50 dark:bg-red-900/5">
                                <td colspan="7" class="px-6 py-3 text-xs text-red-600 dark:text-red-400">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    <span class="font-medium">Rejection reason:</span> {{ application.rejection_reason }}
                                </td>
                            </tr>
                            {% endif %}
                            {% empty %}
                            <tr>
                                <td colspan="7" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                    <div class="flex flex-col items-center">
                                        <div class="w-16 h-16 rounded-full bg-gray-200/50 dark:bg-gray-800/50 flex items-center justify-center mb-3">
                                            <i class="fas fa-file-alt text-2xl text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        <p>No candidate applications found.</p>
                                        <a href="{% url 'core:apply_candidate' %}" class="mt-3 px-4 py-2 bg-gray-900 text-white dark:bg-white dark:text-gray-900 rounded-full text-sm font-medium hover:bg-gray-800 dark:hover:bg-gray-100 transition">
                                            Apply as Candidate
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Team Applications Section -->
        <div class="mb-12">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                <div class="w-10 h-10 rounded-full bg-gray-200/50 dark:bg-gray-800/50 flex items-center justify-center mr-3">
                    <i class="fas fa-users text-gray-600 dark:text-gray-400"></i>
                </div>
                Team Applications
                <span class="ml-3 px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-xs">
                    {{ team_applications|length }} total
                </span>
            </h2>
            
            <!-- Team Applications Table with overflow-x-auto for responsive scrolling -->
            <div class="bg-transparent backdrop-blur-xl border border-white/30 dark:border-white/20 rounded-2xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">#</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Team</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Acronym</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Election</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Color</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Created</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Reviewed</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            {% for team in team_applications %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
                                <td class="px-6 py-4 text-sm text-gray-900 dark:text-white">{{ forloop.counter }}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        {% if team.logo %}
                                        <img src="{{ team.logo.url }}" alt="{{ team.name }}" class="w-8 h-8 rounded-full mr-3 object-cover">
                                        {% else %}
                                        <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                            <i class="fas fa-users text-xs text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        {% endif %}
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">{{ team.name }}</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">{{ team.acronym|default:"—" }}</td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">{{ team.election.name }}</td>
                                <td class="px-6 py-4">
                                    {% if team.color_code %}
                                    <span class="inline-flex items-center">
                                        <span class="w-4 h-4 rounded-full mr-2" style="background-color: {{ team.color_code }};"></span>
                                        <span class="text-xs font-mono text-gray-600 dark:text-gray-400">{{ team.color_code }}</span>
                                    </span>
                                    {% else %}
                                    —
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">{{ team.created_at|date:"M j, Y" }}</td>
                                <td class="px-6 py-4">
                                    <span class="px-3 py-1 rounded-full text-xs font-medium
                                        {% if team.status == 'APPROVED' %}bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400
                                        {% elif team.status == 'PENDING' %}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400
                                        {% elif team.status == 'REJECTED' %}bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400
                                        {% else %}bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400{% endif %}">
                                        {{ team.get_status_display }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                    {% if team.reviewed_at %}
                                        {{ team.reviewed_at|date:"M j, Y" }}
                                        {% if team.reviewed_by %}
                                        <span class="text-xs text-gray-500 block">by {{ team.reviewed_by.full_name }}</span>
                                        {% endif %}
                                    {% else %}
                                        —
                                    {% endif %}
                                </td>
                            </tr>
                            {% if team.rejection_reason %}
                            <tr class="bg-red-50/50 dark:bg-red-900/5">
                                <td colspan="8" class="px-6 py-3 text-xs text-red-600 dark:text-red-400">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    <span class="font-medium">Rejection reason:</span> {{ team.rejection_reason }}
                                </td>
                            </tr>
                            {% endif %}
                            {% empty %}
                            <tr>
                                <td colspan="8" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                    <div class="flex flex-col items-center">
                                        <div class="w-16 h-16 rounded-full bg-gray-200/50 dark:bg-gray-800/50 flex items-center justify-center mb-3">
                                            <i class="fas fa-users text-2xl text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        <p>No team applications found.</p>
                                        <a href="{% url 'core:create_team' %}" class="mt-3 px-4 py-2 bg-gray-900 text-white dark:bg-white dark:text-gray-900 rounded-full text-sm font-medium hover:bg-gray-800 dark:hover:bg-gray-100 transition">
                                            Create a Team
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="text-center mt-8">
            <a href="{% url 'core:elections' %}" 
               class="inline-flex items-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition transform hover:scale-[0.98]">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Elections
            </a>
        </div>
    </div>
</div>

<style>
/* 3D Text Effect */
.hero-text {
    text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transform: perspective(1000px) rotateX(0deg);
    transition: transform 0.3s ease;
}
.hero-text:hover {
    transform: perspective(1000px) rotateX(2deg) translateZ(20px) scale(1.05);
}

/* Smooth transitions */
a, button {
    transition: all 0.3s ease;
}

/* Custom scrollbar for the main content area */
.overflow-y-auto::-webkit-scrollbar {
    width: 8px;
}

.overflow-y-auto::-webkit-scrollbar-track {
    background: transparent;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
    background: rgba(128, 128, 128, 0.3);
    border-radius: 4px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: rgba(128, 128, 128, 0.5);
}

/* Custom scrollbar for overflow tables */
.overflow-x-auto::-webkit-scrollbar {
    height: 6px;
}

.overflow-x-auto::-webkit-scrollbar-track {
    background: transparent;
}

.overflow-x-auto::-webkit-scrollbar-thumb {
    background: rgba(128, 128, 128, 0.3);
    border-radius: 3px;
}

.overflow-x-auto::-webkit-scrollbar-thumb:hover {
    background: rgba(128, 128, 128, 0.5);
}
</style>
{% endblock %}